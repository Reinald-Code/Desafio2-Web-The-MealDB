---
import Layout from '../../layouts/Layout.astro';

const { id } = Astro.params;

const response = await fetch(
  `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`
);
const data = await response.json();
const meal = data.meals[0];

// La API devuelve hasta 20 ingredientes y medidas en campos separados.
// Esta función los une en una sola lista.
const ingredients = [];
for (let i = 1; i <= 20; i++) {
  if (meal[`strIngredient${i}`]) {
    ingredients.push(
      `${meal[`strIngredient${i}`]} - ${meal[`strMeasure${i}`]}`
    );
  }
}
---

<Layout title={meal.strMeal}>
  <div class="mb-6">
    <a href="/" class="bg-orange-500 text-white py-2 px-4 rounded hover:bg-orange-600">
      ← Volver a Inicio
    </a>
  </div>

  <div class="bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-4xl font-extrabold mb-4">{meal.strMeal}</h1>
    <p class="text-lg text-gray-600 mb-4">
      Categoría: <a href={`/category/${meal.strCategory}`} class="text-orange-600 hover:underline">{meal.strCategory}</a> | Origen: {meal.strArea}
    </p>

    <img src={meal.strMealThumb} alt={meal.strMeal} class="w-full max-w-2xl mx-auto rounded-lg mb-6" />

    <div class="grid md:grid-cols-3 gap-8">
      <!-- Columna de Ingredientes -->
      <div class="md:col-span-1">
        <h2 class="text-2xl font-bold mb-3 border-b-2 border-orange-400 pb-2">Ingredientes</h2>
        <ul class="list-disc list-inside space-y-2">
          {ingredients.map(ing => <li>{ing}</li>)}
        </ul>
      </div>

      <!-- Columna de Instrucciones -->
      <div class="md:col-span-2">
        <h2 class="text-2xl font-bold mb-3 border-b-2 border-orange-400 pb-2">Instrucciones</h2>
        <p class="whitespace-pre-wrap leading-relaxed">{meal.strInstructions}</p>
      </div>
    </div>
  </div>
</Layout>